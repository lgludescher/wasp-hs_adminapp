{% extends "base.html" %}

{% block head %}
  <link rel="stylesheet" href="{{ url_for('static', path='css/manage_project.css') }}" />
  <script type="module" src="{{ url_for('static', path='js/manage_project.js') }}"></script>
{% endblock %}

{% block body %}
  <h1 class="page-title">Project Details</h1>

  <section id="project-details-section" class="details-box">
    <!-- Project details will be populated by JS -->
  </section>

  <!-- Panel Stubs -->
  <div class="panel">
    <div class="panel-header">
      <button class="expand-btn btn" data-panel="members">+</button>
      <h2>Members <span id="count-members" class="panel-count"></span> </h2>
    </div>
    <div id="panel-content-members" class="panel-content hidden">
      <div class="panel-actions-bar">
        <button class="btn btn-secondary btn-show-add-form">Add Member</button>

        <button id="btn-export-project-emails" class="btn btn-icon" title="Copy Email List">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
            </svg>
        </button>
      </div>
      <form class="item-add-form hidden">
        <fieldset>
          <label>Role:
            <select name="member_role_filter">
              <option value="researchers" selected>Researcher</option>
              <option value="phd-students">PhD Student</option>
              <option value="postdocs">Postdoc</option>
            </select>
          </label>
          <label>Person:
            <select name="person_role_id" required></select>
          </label>
          <div class="detail-item"><label class="checkbox-label"><input name="is_pi" type="checkbox"> Principal Investigator?</label></div>
          <div class="detail-item"><label class="checkbox-label"><input name="is_contact_person" type="checkbox"> Contact Person?</label></div>
          <div class="form-actions">
            <button type="submit" class="btn btn-secondary save-btn">Save</button>
            <button type="button" class="btn btn-secondary cancel-btn">Cancel</button>
          </div>
        </fieldset>
      </form>

      <div class="panel-filters">
          <label>Status:
            <select id="filter-members-status">
              <option value="true" selected>Active Members</option>
              <option value="">All Members</option>
              <option value="false">Inactive Members</option>
            </select>
          </label>
          <label>Role:
            <select id="filter-members-pi">
              <option value="">All</option>
              <option value="true">Principal Investigators Only</option>
            </select>
          </label>
          <label>Contact:
            <select id="filter-members-contact">
              <option value="">All</option>
              <option value="true">Contact Persons Only</option>
            </select>
          </label>
      </div>

      <div class="list-container">
        <table class="data-table"><thead></thead><tbody></tbody></table>
      </div>
    </div>
  </div>

  <div class="panel">
    <div class="panel-header">
      <button class="expand-btn btn" data-panel="fields">+</button>
      <h2>Academic Fields <span id="count-fields" class="panel-count"></span> </h2>
    </div>
    <div id="panel-content-fields" class="panel-content hidden">
      <button class="btn btn-secondary btn-show-add-form">Add Academic Field</button>
      <form class="item-add-form hidden">
        <fieldset>
          <label>Filter by Branch:
            <select name="field_branch_filter"></select>
          </label>
          <label>Field:
            <select name="field_id" required></select>
          </label>
          <div class="form-actions">
            <button type="submit" class="btn btn-secondary save-btn">Save</button>
            <button type="button" class="btn btn-secondary cancel-btn">Cancel</button>
          </div>
        </fieldset>
      </form>
      <div class="list-container">
        <table class="data-table"><thead></thead><tbody></tbody></table>
      </div>
    </div>
  </div>

  <div class="panel">
    <div class="panel-header">
      <button class="expand-btn btn" data-panel="outputs">+</button>
      <h2>Research Output Reports <span id="count-outputs" class="panel-count"></span> </h2>
    </div>
    <div id="panel-content-outputs" class="panel-content hidden">
      <button class="btn btn-secondary btn-show-add-form">Add Research Output Report</button>
      <form class="item-add-form hidden">
        <fieldset>
          <label>Link:
            <input name="link" type="text" required placeholder="https://...">
          </label>
          <div class="form-actions">
            <button type="submit" class="btn btn-secondary save-btn">Save</button>
            <button type="button" class="btn btn-secondary cancel-btn">Cancel</button>
          </div>
        </fieldset>
      </form>
      <div class="list-container">
        <table class="data-table"><thead></thead><tbody></tbody></table>
      </div>
    </div>
  </div>

  <div class="panel">
    <div class="panel-header">
      <button class="expand-btn btn" data-panel="letters">+</button>
      <h2>Decision Letters <span id="count-letters" class="panel-count"></span> </h2>
    </div>
    <div id="panel-content-letters" class="panel-content hidden">
      <button class="btn btn-secondary btn-show-add-form">Add Decision Letter</button>
      <form class="item-add-form hidden">
        <fieldset>
          <label>Link:
            <input name="link" type="text" required placeholder="https://...">
          </label>
          <div class="form-actions">
            <button type="submit" class="btn btn-secondary save-btn">Save</button>
            <button type="button" class="btn btn-secondary cancel-btn">Cancel</button>
          </div>
        </fieldset>
      </form>
      <div class="list-container">
        <table class="data-table"><thead></thead><tbody></tbody></table>
      </div>
    </div>
  </div>


  <!-- Reusable Modal -->
  <div id="modal-confirm" class="modal hidden">
    <div class="modal-content">
      <p id="modal-text"></p>
      <div class="modal-actions">
        <button id="modal-confirm-btn" class="btn">Confirm</button>
        <button id="modal-cancel-btn" class="btn cancel-btn">Cancel</button>
      </div>
    </div>
  </div>
{% endblock %}
